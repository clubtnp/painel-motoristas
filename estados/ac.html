<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Rede de Motoristas</title>
  <style>
    /* Estilos Gerais */
    body { font-family: Arial, sans-serif; background: #0f172a; color: #fff; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 40px 16px; box-sizing: border-box; }
    .container { width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 24px; }
    .box { background: #020617; padding: 24px; border-radius: 16px; box-shadow: 0 0 20px rgba(0,0,0,.5); }
    
    .capa-container { text-align: center; margin-bottom: 8px; }
    .capa-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #22c55e; object-fit: cover; box-shadow: 0 0 15px rgba(34, 197, 94, 0.3); }
    .capa-titulo { margin-top: 12px; font-size: 18px; font-weight: bold; color: #22c55e; }

    h1 { text-align: center; margin-bottom: 10px; font-size: 22px; }
    p { text-align: center; font-size: 14px; opacity: .8; }
    select, button { width: 100%; padding: 14px; margin-top: 16px; border-radius: 12px; border: none; font-size: 16px; }
    select { background: #1e293b; color: #fff; }
    button { background: #22c55e; color: #020617; font-weight: bold; cursor: pointer; transition: opacity 0.2s; }
    .btn-secondary { background: #1e293b; color: #fff; }
    button:hover { opacity: .9; }
    
    /* Estilo para os filtros de categoria */
    .filtro-categoria {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      background: #1e293b;
      color: #fff;
      border: 1px solid #334155;
      font-size: 14px;
      outline: none;
    }
    .filtro-categoria:focus { border-color: #22c55e; }

    /* Estilos do Carrossel e Árvore (Mantidos conforme original) */
    #container-arvore { margin-top: 20px; overflow: auto; height: 255px; border: 1px solid #1e293b; border-radius: 12px; background: #020617; padding: 20px 0; box-sizing: border-box; position: relative; }
    #wrapper-arvore { display: flex; flex-direction: column; gap: 20px; width: max-content; min-width: 100%; padding: 0 20px; align-items: center; }
    .carrossel-container { position: relative; margin-top: 16px; background: #1e293b; border-radius: 12px; padding: 16px; border: 1px solid #334155; min-height: 370px; display: flex; align-items: center; justify-content: center; }
    .carrossel-wrapper { display: flex; overflow: hidden; width: 100%; border-radius: 8px; position: relative; min-height: 330px; }
    .carrossel-dots { display: flex; justify-content: center; align-items: center; gap: 6px; margin-top: 14px; min-height: 32px; flex-wrap: wrap; }
    .num-page { min-width: 30px; height: 30px; border-radius: 6px; background: #1e293b; color: #fff; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #334155; }
    .num-page.active { background: #22c55e; color: #020617; border-color: #22c55e; }
  </style>
</head>
<body>

  <div class="container">
    <div class="capa-container">
      <img src="https://files.manuscdn.com/user_upload_by_module/session_file/310519663183776805/TBToCHjaxmWFWXCg.png" alt="Capa" class="capa-img">
      <div class="capa-titulo">Pessoas Colaborativas ganham até dormindo</div>
    </div>

    <div class="box">
      <h1>Buscar motoristas</h1>
      <p>Escolha sua cidade</p>
      <select id="selectCidade"><option value="">Carregando cidades...</option></select>
      <button id="btnBuscar">Buscar motoristas</button>
      <div id="status"></div>
    </div>

    <div class="box">
      <h1>Árvore da Rede</h1>
      <p>Arraste para explorar</p>
      <div id="container-arvore"><div id="wrapper-arvore"></div></div>
      <button id="btnCadastrarArvore">Cadastrar na árvore</button>
    </div>

    <div class="box">
      <h1>Grupo de Motoristas</h1>
      <div id="carrossel-motoristas" class="carrossel-container"></div>
      <div id="dots-motoristas" class="carrossel-dots"></div>
      <select id="filtro-motoristas" class="filtro-categoria"><option value="">Todas as Categorias (Motoristas )</option></select>
      <button class="btn-secondary" id="btnCadastrarGrupo">Cadastrar meu grupo</button>
    </div>

    <div class="box">
      <h1>Grupos de Comércios</h1>
      <div id="carrossel-comercio" class="carrossel-container"></div>
      <div id="dots-comercio" class="carrossel-dots"></div>
      <select id="filtro-comercio" class="filtro-categoria"><option value="">Todas as Categorias (Comércio)</option></select>
      <button class="btn-secondary" id="btnCadastrarComercio">Cadastrar grupo comercial</button>
    </div>

    <div class="box">
      <h1>Instagram</h1>
      <p>Nossas Redes Oficiais</p>
      <div id="carrossel-instagram" class="carrossel-container"></div>
      <div id="dots-instagram" class="carrossel-dots"></div>
      <select id="filtro-instagram" class="filtro-categoria"><option value="">Todas as Categorias (Instagram)</option></select>
    </div>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby-O5_0f2v67N39zN0507N8Z9z0507N8Z9z0507N8Z9z/exec'; // Substitua pela sua URL real

    async function carregarCidades( ) {
      const select = document.getElementById('selectCidade');
      try {
        const response = await fetch(`${SCRIPT_URL}?listar=cidades`);
        const cidades = await response.json();
        select.innerHTML = '<option value="">Selecione uma cidade</option>';
        cidades.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c; opt.textContent = c;
          select.appendChild(opt);
        });
      } catch (e) { select.innerHTML = '<option value="">Erro ao carregar</option>'; }
    }

    document.getElementById('btnBuscar').onclick = async () => {
      const cidade = document.getElementById('selectCidade').value;
      const status = document.getElementById('status');
      if (!cidade) return alert('Selecione uma cidade');

      status.innerText = 'Buscando...';
      status.style.display = 'block';

      try {
        const response = await fetch(`${SCRIPT_URL}?cidade=${encodeURIComponent(cidade)}`);
        const data = await response.json();
        status.style.display = 'none';

        // ATIVAÇÃO DOS FILTROS
        atualizarFiltrosCategorias(data);

        renderizarArvore(data.arvore);
        renderizarCarrossel(data.gruposMotoristas, 'carrossel-motoristas', 'dots-motoristas');
        renderizarCarrossel(data.gruposComercio, 'carrossel-comercio', 'dots-comercio');
        renderizarCarrossel(data.instagram, 'carrossel-instagram', 'dots-instagram');
      } catch (e) { status.innerText = 'Erro na busca'; }
    };

    function renderizarCarrossel(lista, containerId, dotsId) {
      const container = document.getElementById(containerId);
      const dots = document.getElementById(dotsId);
      container.innerHTML = ''; dots.innerHTML = '';
      
      if (!lista || lista.length === 0) {
        container.innerHTML = '<p class="carrossel-vazio">Nenhum item encontrado.</p>';
        return;
      }

      lista.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'carrossel-item';
        div.style.display = idx === 0 ? 'flex' : 'none';
        div.innerHTML = `
          <img src="${item.imagem || ''}" class="grupo-imagem">
          <div class="grupo-nome">${item.nome}</div>
          <div class="grupo-categoria">${item.categoria}</div>
          <button onclick="window.open('${item.link}')">Entrar no Grupo</button>
        `;
        container.appendChild(div);

        const dot = document.createElement('div');
        dot.className = `num-page ${idx === 0 ? 'active' : ''}`;
        dot.textContent = idx + 1;
        dot.onclick = () => {
          Array.from(container.children).forEach((c, i) => c.style.display = i === idx ? 'flex' : 'none');
          Array.from(dots.children).forEach((d, i) => d.classList.toggle('active', i === idx));
        };
        dots.appendChild(dot);
      });
    }

    function renderizarArvore(arvore) {
      const wrapper = document.getElementById('wrapper-arvore');
      wrapper.innerHTML = '';
      if (!arvore) return;
      arvore.forEach(nivel => {
        const divNivel = document.createElement('div');
        divNivel.className = 'nivel-arvore';
        nivel.forEach(mot => {
          const item = document.createElement('div');
          item.className = 'item-motorista';
          item.innerHTML = `<span>${mot.nome}</span>`;
          divNivel.appendChild(item);
        });
        wrapper.appendChild(divNivel);
      });
    }

    function atualizarFiltrosCategorias(dados) {
      const mapeamento = [
        { id: 'filtro-motoristas', lista: dados.gruposMotoristas, container: 'carrossel-motoristas', dots: 'dots-motoristas', label: 'Motoristas' },
        { id: 'filtro-comercio', lista: dados.gruposComercio, container: 'carrossel-comercio', dots: 'dots-comercio', label: 'Comércio' },
        { id: 'filtro-instagram', lista: dados.instagram, container: 'carrossel-instagram', dots: 'dots-instagram', label: 'Instagram' }
      ];

      mapeamento.forEach(item => {
        const select = document.getElementById(item.id);
        if (!select) return;

        const categorias = [...new Set(item.lista.map(i => i.categoria))]
          .filter(c => c && c.trim() !== "")
          .sort((a, b) => a.localeCompare(b, 'pt-BR'));

        select.innerHTML = `<option value="">Todas as Categorias (${item.label})</option>`;
        categorias.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat; option.textContent = cat;
          select.appendChild(option);
        });

        select.onchange = () => {
          const filtrados = select.value ? item.lista.filter(i => i.categoria === select.value) : item.lista;
          renderizarCarrossel(filtrados, item.container, item.dots);
        };
      });
    }

    carregarCidades();
  </script>
</body>
</html>

